---
import Layout from '../../layouts/Layout.astro';
import { getAlleFahrzeugSlugs, getFahrzeugBySlug, urlFor } from '../../lib/sanity';
import type { Fahrzeug } from '../../types/sanity';

// Generiert alle Seiten bei Build-Time
export async function getStaticPaths() {
  const slugs = await getAlleFahrzeugSlugs();
  
  return slugs.map((item: { slug: string }) => ({
    params: { slug: item.slug }
  }));
}

const { slug } = Astro.params;
const fahrzeug: Fahrzeug = await getFahrzeugBySlug(slug!);

// 404 wenn nicht gefunden
if (!fahrzeug) {
  return Astro.redirect('/404');
}

const title = `${fahrzeug.marke} ${fahrzeug.modell} | AHAM Automobile`;
const description = `${fahrzeug.marke} ${fahrzeug.modell} (${fahrzeug.baujahr}) für ${fahrzeug.preis?.toLocaleString('de-DE')}€`;
---

<Layout title={title} description={description}>
  <main>
    <article>
      <img 
        src={urlFor(fahrzeug.hauptbild).width(800).height(600).url()} 
        alt={`${fahrzeug.marke} ${fahrzeug.modell}`}
      />
      
      <h1>{fahrzeug.marke} {fahrzeug.modell}</h1>
      
      <p class="preis">{fahrzeug.preis?.toLocaleString('de-DE')} €</p>
      
      <ul>
        <li>Baujahr: {fahrzeug.baujahr}</li>
        <li>Kilometerstand: {fahrzeug.kilometerstand?.toLocaleString('de-DE')} km</li>
        <li>Kraftstoff: {fahrzeug.kraftstoff}</li>
        <li>Getriebe: {fahrzeug.getriebe}</li>
        {fahrzeug.leistungPS && <li>Leistung: {fahrzeug.leistungPS} PS</li>}
      </ul>
      
      {fahrzeug.beschreibung && (
        <div>
          <h2>Beschreibung</h2>
          <p>{fahrzeug.beschreibung}</p>
        </div>
      )}
      
      {fahrzeug.ausstattung && fahrzeug.ausstattung.length > 0 && (
        <div>
          <h2>Ausstattung</h2>
          <ul>
            {fahrzeug.ausstattung.map((item) => (
              <li>{item}</li>
            ))}
          </ul>
        </div>
      )}
      
      <a href="tel:01708949479">Jetzt anrufen: 0170 8949479</a>
    </article>
  </main>
</Layout>